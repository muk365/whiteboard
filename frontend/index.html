<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <title>Tableau Blanc Collaboratif Pro</title>
    
    <link href="/static/css/style.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .options-panel { transition: opacity 0.2s ease-out, transform 0.2s ease-out; }
        .options-panel.hidden { opacity: 0; transform: translateY(-10px); pointer-events: none; }
        #side-menu { transition: transform 0.3s ease-in-out; }
        #menu-backdrop { transition: opacity 0.3s ease-in-out; }
        .remote-cursor { transition: transform 0.1s ease-out; }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-hidden">

    <div id="app-container" class="relative w-screen h-screen">
        
        <!-- Menu et ses composants (inchangés) -->
        <button id="menu-toggle-btn" class="absolute top-4 left-4 z-40 p-3 bg-gray-800/80 backdrop-blur-sm rounded-full text-white hover:bg-gray-700 transition-all border border-gray-700"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg></button>
        <div id="menu-backdrop" class="hidden fixed inset-0 bg-black/50 z-20"></div>
        <div id="side-menu" class="fixed top-0 left-0 h-full w-72 bg-gray-900/90 backdrop-blur-lg border-r border-gray-700 shadow-2xl z-30 pt-20 px-6 pb-6 flex flex-col space-y-6 -translate-x-full"><h2 class="text-xl font-semibold text-white">Collaboration</h2><div><label for="username-input" class="text-sm font-medium text-gray-400">Votre Pseudo</label><input type="text" id="username-input" class="mt-1 w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"></div><div><label class="text-sm font-medium text-gray-400">ID de la Salle Actuelle</label><div class="mt-1 w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-gray-300 font-mono text-sm break-words" id="current-room-id"></div></div><div><label for="join-room-input" class="text-sm font-medium text-gray-400">Rejoindre une Salle</label><div class="mt-1 flex space-x-2"><input type="text" id="join-room-input" placeholder="Coller un ID ici" class="flex-grow min-w-0 bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"><button id="join-room-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-500 transition-all">OK</button></div></div><div class="flex-grow flex flex-col min-h-0"><h3 class="text-sm font-medium text-gray-400 mb-2">Participants</h3><ul id="user-list" class="flex-grow overflow-y-auto space-y-2 pr-2"></ul></div></div>

        <!-- Barre d'outils avec la GOMME FINALE -->
        <div id="toolbar" class="absolute top-4 left-1/2 -translate-x-1/2 z-10 bg-gray-800/80 backdrop-blur-sm shadow-2xl rounded-full p-2 flex items-center space-x-1 border border-gray-700">
            <button class="tool-btn p-3 rounded-full" data-tool="select" title="Sélectionner"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 pointer-events-none"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z" /></svg></button>
            <button class="tool-btn p-3 rounded-full" data-tool="pencil" title="Dessiner"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 pointer-events-none"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg></button>
            
            <!-- VERSION FINALE : L'ICÔNE DE LA GOMME -->
            <button class="tool-btn p-3 rounded-full" data-tool="eraser" title="Gommer">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 pointer-events-none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                   <path d="M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3"></path>
                   <path d="M18 13.3l-6.3 -6.3"></path>
                </svg>
            </button>
            
            <div class="h-6 w-px bg-gray-600 mx-1"></div>
            <button id="color-picker-btn" class="p-3 rounded-full" title="Couleur du pinceau"><div id="color-indicator" class="w-5 h-5 rounded-full border-2 border-gray-400 pointer-events-none" style="background-color: white;"></div></button>
            <button id="brush-size-btn" class="p-3 rounded-full" title="Taille du pinceau"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 pointer-events-none"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></button>
            <div class="h-6 w-px bg-gray-600 mx-1"></div>
            <button id="clear-all-btn" class="p-3 rounded-full text-red-400 hover:bg-red-500/20" title="Tout effacer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 pointer-events-none"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></button>
        </div>

        <div id="color-palette" class="options-panel hidden absolute top-20 left-1/2 -translate-x-1/2 z-10 bg-gray-800/80 backdrop-blur-sm shadow-2xl rounded-xl p-3 grid grid-cols-5 gap-2 border border-gray-700"></div>
        <div id="brush-size-panel" class="options-panel hidden absolute top-20 left-1/2 -translate-x-1/2 z-10 bg-gray-800/80 backdrop-blur-sm shadow-2xl rounded-xl p-4 border border-gray-700 flex items-center space-x-2"><span id="brush-size-label" class="text-sm w-8 text-center">4</span><input id="brush-size-slider" type="range" min="1" max="50" value="4" class="w-32"></div>

        <canvas id="whiteboard-canvas"></canvas>
        <div id="cursors-container" class="absolute inset-0 pointer-events-none z-50"></div>
        
        <!-- Modèle de curseur (inchangé) -->
        <div id="cursor-template" class="hidden absolute top-0 left-0 pointer-events-none remote-cursor flex items-center">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <span class="ml-2 px-2 py-0.5 text-sm rounded-full whitespace-nowrap text-white" style="background-color: black;"></span>
        </div>

    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>